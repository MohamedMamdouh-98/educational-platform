<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>TPACK Wheel · Spinner</title>
    <!-- Google Fonts & Font Awesome -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Cairo", sans-serif;
      }

      body {
        background: linear-gradient(145deg, #5e3e2b 0%, #7e5a40 100%);
        height: 100vh;
        width: 100vw;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 12px;
        overflow: hidden;
      }

      .main-card {
        background: #faefdd;
        padding: 16px 18px 20px;
        border-radius: 40px 40px 35px 35px;
        box-shadow: 0 20px 30px rgba(34, 19, 8, 0.8);
        max-width: 800px;
        width: 100%;
        height: 96vh;
        max-height: 700px;
        border: 6px solid #a67b5b;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .main-card::after {
        content: "⚘⚘⚘";
        position: absolute;
        bottom: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #dbbc9e;
        color: #543b28;
        font-size: 16px;
        letter-spacing: 12px;
        padding: 4px 28px;
        border-radius: 40px;
        box-shadow: inset 0 -3px 0 #7a5a44;
        border: 2px solid #f3dabc;
      }

      h1 {
        text-align: center;
        color: #5a3e2b;
        font-weight: 800;
        font-size: 1.7rem;
        margin-top: 0;
        margin-bottom: 5px;
        text-shadow: 2px 2px 0 #e7d2b5;
        letter-spacing: 1px;
        word-break: break-word;
        line-height: 1.2;
      }

      h1 i {
        color: #8b5a2b;
        margin: 0 6px;
        font-size: 1.5rem;
        filter: drop-shadow(2px 2px 2px #b49475);
      }

      /* wheel container - perfectly fit */
      .wheel-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        flex: 0 1 auto;
      }

      .canvas-container {
        position: relative;
        width: min(380px, 45vh);
        height: min(380px, 45vh);
        margin: 0 auto 8px;
      }

      canvas {
        width: 100%;
        height: 100%;
        display: block;
        border-radius: 50%;
        border: 8px solid #8f6b4b;
        box-shadow:
          inset 0 0 0 5px #efdecb,
          0 15px 25px rgba(44, 26, 8, 0.8);
        transition: transform 0.08s;
        background: #b89474;
        cursor: pointer;
      }

      canvas:active {
        transform: scale(0.98);
      }

      .pointer {
        position: absolute;
        top: -18px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 44px;
        color: #62371e;
        text-shadow:
          0 10px 8px #2d1e12,
          0 0 0 4px #fbebd2;
        z-index: 15;
        filter: drop-shadow(0 6px 0 #8b674b);
      }

      /* button below wheel - compact */
      .spin-btn-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        margin: 5px 0 8px;
      }

      .btn-spin {
        background: radial-gradient(circle at 30% 30%, #ffefd1, #9e785a);
        border: none;
        padding: 12px 40px;
        border-radius: 60px;
        font-size: 1.9rem;
        font-weight: 900;
        color: #2c1c10;
        cursor: pointer;
        box-shadow:
          0 10px 0 #4f3727,
          0 15px 25px #2f1d11,
          inset 0 -4px 8px rgba(0, 0, 0, 0.4),
          inset 0 4px 8px rgba(255, 240, 200, 0.9);
        transition: 0.04s linear;
        display: flex;
        align-items: center;
        gap: 12px;
        border: 4px solid #fff0cf;
        letter-spacing: 6px;
      }

      .btn-spin i {
        font-size: 1.9rem;
        color: #412e1b;
        text-shadow: 0 3px 5px #d6a77a;
      }

      .btn-spin:active {
        transform: translateY(8px);
        box-shadow:
          0 2px 0 #4f3727,
          0 12px 20px #2f1d11,
          inset 0 -2px 5px rgba(0, 0, 0, 0.2);
      }

      /* question box - compact */
      .question-box {
        background: #e5cfb5;
        margin-top: 5px;
        padding: 14px 20px;
        border-radius: 50px 30px 50px 30px;
        border-right: 12px solid #714f36;
        border-bottom: 12px solid #9e7a60;
        box-shadow:
          inset 0 0 0 4px #fff8eb,
          0 12px 20px #38291e;
        color: #281c12;
        font-size: 1.1rem;
        font-weight: 700;
        text-align: center;
        word-break: break-word;
        background: linear-gradient(145deg, #fbefdf, #ddc2a8);
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #fff3df;
        flex: 0 1 auto;
        width: 100%;
      }

      .question-box i {
        margin-left: 12px;
        color: #693f25;
        font-size: 1.4rem;
        text-shadow: 2px 2px 0 #ebd5b8;
      }

      .selected-q-text {
        line-height: 1.4;
        flex: 1;
      }

      /* footer completely empty */
      .footer-note {
        display: none;
      }

      /* responsive - perfect fit for any screen */
      @media (max-width: 600px) {
        body {
          padding: 8px;
        }
        .main-card {
          padding: 12px 14px 16px;
          max-height: 650px;
        }
        h1 {
          font-size: 1.4rem;
        }
        h1 i {
          font-size: 1.2rem;
        }
        .canvas-container {
          width: min(300px, 40vh);
          height: min(300px, 40vh);
        }
        .pointer {
          font-size: 38px;
          top: -16px;
        }
        .btn-spin {
          font-size: 1.6rem;
          padding: 10px 30px;
        }
        .btn-spin i {
          font-size: 1.6rem;
        }
        .question-box {
          font-size: 0.95rem;
          padding: 12px 16px;
        }
      }

      @media (max-width: 400px) {
        .main-card {
          padding: 10px 12px 14px;
        }
        h1 {
          font-size: 1.2rem;
        }
        .canvas-container {
          width: min(250px, 35vh);
          height: min(250px, 35vh);
        }
        .pointer {
          font-size: 32px;
          top: -14px;
        }
        .btn-spin {
          font-size: 1.4rem;
          padding: 8px 25px;
        }
        .question-box {
          font-size: 0.85rem;
          padding: 10px 12px;
        }
      }

      @media (max-height: 700px) {
        .main-card {
          max-height: 600px;
        }
        .canvas-container {
          width: min(320px, 40vh);
          height: min(320px, 40vh);
        }
        .btn-spin {
          padding: 10px 35px;
          font-size: 1.7rem;
        }
      }

      @media (max-height: 600px) {
        .main-card {
          max-height: 550px;
          padding: 10px 12px;
        }
        .canvas-container {
          width: min(280px, 38vh);
          height: min(280px, 38vh);
        }
        h1 {
          font-size: 1.3rem;
          margin-bottom: 2px;
        }
        .btn-spin {
          padding: 8px 30px;
          font-size: 1.5rem;
        }
        .btn-spin i {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-card">
      <h1>
        <i class="fas fa-pencil-alt"></i>
        TPACK WHEEL
        <i class="fas fa-arrow-rotate-left"></i>
      </h1>

      <div class="wheel-wrapper">
        <!-- wheel area with pointer -->
        <div class="canvas-container" style="position: relative">
          <div class="pointer">
            <i class="fas fa-caret-down"></i>
          </div>
          <canvas id="wheelCanvas" width="600" height="600"></canvas>
        </div>

        <!-- SPIN button below wheel - compact -->
        <div class="spin-btn-container">
          <button class="btn-spin" id="spinButton">
            <i class="fas fa-sync-alt"></i> SPIN
          </button>
        </div>
      </div>

      <!-- selected question shows here -->
      <div class="question-box" id="selectedQuestionBox">
        <span class="selected-q-text" id="questionText"
          >Press SPIN or tap the wheel</span
        >
        <i class="fas fa-question"></i>
      </div>

      <!-- footer completely empty -->
      <div class="footer-note"></div>
    </div>

    <script>
      (function () {
        "use strict";

        // ---------- TPACK questions (English only) ----------
        const questions = [
          "What is the main idea of the TPACK model?",
          "What is the difference between (CK) and (TCK)?",
          "What is the difference between (TK) and (TPK)?",
          "What are the main components of the TPACK model?",
        ];

        // ---------- Brown palette - opened up / brighter & rich browns ----------
        const brownPalette = [
          "#B5673A",
          "#A1582E",
          "#8C5A3C",
          "#C17B4D",
          "#9E6B4E",
          "#B47C5A",
          "#7A5B4A",
          "#C48A5C",
          "#A5714F",
          "#8B5E3C",
          "#B86138",
          "#9F7248",
        ];

        // canvas elements
        const canvas = document.getElementById("wheelCanvas");
        const ctx = canvas.getContext("2d");
        const spinBtn = document.getElementById("spinButton");
        const questionSpan = document.getElementById("questionText");

        // wheel state
        let currentAngle = 0;
        let spinning = false;
        let spinVelocity = 0;
        let spinDecay = 0.985;
        let minVelocity = 0.008;
        let animationFrame = null;
        const sliceAngle = (2 * Math.PI) / questions.length;

        // ---------- Web Audio with real spinning sound ----------
        let audioContext = null;

        function initAudio() {
          if (audioContext) return;
          try {
            audioContext = new (
              window.AudioContext || window.webkitAudioContext
            )();
            if (audioContext.state === "suspended") {
              audioContext.resume();
            }
          } catch (e) {
            console.log("Web Audio API not supported");
          }
        }

        // play wooden tick sound (realistic wheel sound)
        function playSpinSound(intensity = 1) {
          if (!audioContext) {
            initAudio();
            if (!audioContext) return;
          }

          if (audioContext.state === "suspended") {
            audioContext
              .resume()
              .then(() => {
                generateTick(intensity);
              })
              .catch(() => {});
          } else {
            generateTick(intensity);
          }
        }

        function generateTick(intensity = 1) {
          if (!audioContext) return;

          try {
            const now = audioContext.currentTime;

            // main wooden knock
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();
            osc1.type = "sine";
            osc1.frequency.value = 200 + Math.random() * 50;
            gain1.gain.setValueAtTime(0.25 * intensity, now);
            gain1.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc1.connect(gain1);
            gain1.connect(audioContext.destination);
            osc1.start(now);
            osc1.stop(now + 0.12);

            // low thud
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.type = "triangle";
            osc2.frequency.value = 70 + Math.random() * 20;
            gain2.gain.setValueAtTime(0.14 * intensity, now);
            gain2.gain.exponentialRampToValueAtTime(0.001, now + 0.09);
            osc2.connect(gain2);
            gain2.connect(audioContext.destination);
            osc2.start(now);
            osc2.stop(now + 0.1);

            // short click (spinning tick)
            if (intensity > 0.6) {
              const osc3 = audioContext.createOscillator();
              const gain3 = audioContext.createGain();
              osc3.type = "square";
              osc3.frequency.value = 340;
              gain3.gain.setValueAtTime(0.07 * intensity, now);
              gain3.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
              osc3.connect(gain3);
              gain3.connect(audioContext.destination);
              osc3.start(now);
              osc3.stop(now + 0.04);
            }
          } catch (e) {}
        }

        // ---------- Vibration for mobile only ----------
        // function triggerVibration() {
        //   const isMobile =
        //     /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
        //       navigator.userAgent,
        //     );
        //   if (isMobile && window.navigator.vibrate) {
        //     window.navigator.vibrate(40);
        //     setTimeout(() => {
        //       window.navigator.vibrate(20);
        //     }, 60);
        //   }
        // }

        // ---------- draw wheel with perfect scaling ----------
        function drawWheel(angle) {
          const w = canvas.width;
          const h = canvas.height;
          const cx = w / 2;
          const cy = h / 2;
          const radius = Math.min(w, h) * 0.4;

          ctx.clearRect(0, 0, w, h);
          ctx.shadowColor = "#2b1a0e";
          ctx.shadowBlur = 14;

          // draw slices
          for (let i = 0; i < questions.length; i++) {
            const start = angle + i * sliceAngle;
            const end = start + sliceAngle;

            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, start, end);
            ctx.closePath();

            ctx.fillStyle = brownPalette[i % brownPalette.length];
            ctx.fill();

            ctx.strokeStyle = "#fae6cc";
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, start, end);
            ctx.lineTo(cx, cy);
            ctx.stroke();
          }

          ctx.shadowBlur = 0;

          // text short labels - scaled for smaller wheel
          ctx.font = 'bold 18px "Cairo", sans-serif';
          ctx.fillStyle = "#fffcf2";
          ctx.shadowColor = "#38271a";
          ctx.shadowBlur = 6;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";

          for (let i = 0; i < questions.length; i++) {
            const mid = angle + i * sliceAngle + sliceAngle / 2;
            const textRadius = radius * 0.7;
            const x = cx + Math.cos(mid) * textRadius;
            const y = cy + Math.sin(mid) * textRadius;

            let short = "";
            if (questions[i].includes("main idea")) short = "TPACK?";
            else if (
              questions[i].includes("CK") &&
              questions[i].includes("TCK")
            )
              short = "CK/TCK";
            else if (
              questions[i].includes("TK") &&
              questions[i].includes("TPK")
            )
              short = "TK/TPK";
            else if (questions[i].includes("components")) short = "COMP";
            else short = "TPACK";

            ctx.fillText(short, x, y);
          }

          // center decoration
          ctx.shadowBlur = 10;
          ctx.beginPath();
          ctx.arc(cx, cy, radius * 0.2, 0, 2 * Math.PI);
          ctx.fillStyle = "#e7cfb0";
          ctx.fill();
          ctx.shadowBlur = 0;
          ctx.strokeStyle = "#8f6b4b";
          ctx.lineWidth = 6;
          ctx.stroke();

          ctx.beginPath();
          ctx.arc(cx, cy, radius * 0.1, 0, 2 * Math.PI);
          ctx.fillStyle = "#5b3a23";
          ctx.fill();
        }

        // ---------- get question based on angle ----------
        function getSelectedQuestion(angle) {
          let normAngle = angle % (2 * Math.PI);
          if (normAngle < 0) normAngle += 2 * Math.PI;
          const pointerRad = (3 * Math.PI) / 2;
          let diff = (pointerRad - normAngle + 2 * Math.PI) % (2 * Math.PI);
          let idx = Math.floor(diff / sliceAngle) % questions.length;
          return questions[idx];
        }

        function updateQuestionText() {
          questionSpan.textContent = getSelectedQuestion(currentAngle);
        }

        // ---------- spin loop with sound and vibration ----------
        function spinLoop() {
          if (!spinning) return;

          spinVelocity *= spinDecay;
          currentAngle += spinVelocity;
          currentAngle %= 2 * Math.PI;

          drawWheel(currentAngle);
          updateQuestionText();

          // play sound while spinning
          if (Math.abs(spinVelocity) > 0.02) {
            playSpinSound(Math.min(Math.abs(spinVelocity) * 0.9, 1.1));

            // mobile vibration during fast spin
            if (Math.abs(spinVelocity) > 0.12) {
              const isMobile =
                /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                  navigator.userAgent,
                );
              if (
                isMobile &&
                window.navigator.vibrate &&
                Math.random() < 0.25
              ) {
                window.navigator.vibrate(12);
              }
            }
          }

          if (Math.abs(spinVelocity) < minVelocity) {
            spinning = false;
            spinVelocity = 0;
            playSpinSound(1.3);
            if (animationFrame) cancelAnimationFrame(animationFrame);
            animationFrame = null;
          } else {
            animationFrame = requestAnimationFrame(spinLoop);
          }
        }

        // ---------- start spinning ----------
        function startSpin() {
          initAudio();

          if (audioContext) {
            if (audioContext.state === "suspended") {
              audioContext.resume().then(() => {
                playSpinSound(1.6);
              });
            } else {
              playSpinSound(1.6);
            }
          }

          if (spinning) {
            spinning = false;
            if (animationFrame) {
              cancelAnimationFrame(animationFrame);
              animationFrame = null;
            }
          }

          spinVelocity = 1.5 + Math.random() * 2.5;
          spinVelocity *= Math.random() > 0.4 ? 1 : -1;
          spinning = true;
          animationFrame = requestAnimationFrame(spinLoop);
        }

        // ---------- initialization ----------
        function init() {
          currentAngle = Math.random() * 2 * Math.PI;
          drawWheel(currentAngle);
          updateQuestionText();

          spinBtn.addEventListener("click", startSpin);
          canvas.addEventListener("click", startSpin);

          document.body.addEventListener(
            "touchstart",
            function initTouch() {
              initAudio();
              document.body.removeEventListener("touchstart", initTouch);
            },
            { once: true },
          );

          document.body.addEventListener(
            "click",
            function initClick() {
              initAudio();
              document.body.removeEventListener("click", initClick);
            },
            { once: true },
          );

          initAudio();

          canvas.addEventListener("contextmenu", (e) => e.preventDefault());
        }

        init();
      })();
    </script>
  </body>
</html>
